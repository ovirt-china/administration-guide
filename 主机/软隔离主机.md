# 软隔离主机

有时候主机可能由于未知的问题变成无响应的状态，虽然 VDSM
无法响应请求，依赖于 VDSM
的虚拟机却依然存活并且可以进入。在这种情况下，您可以重启 VDSM 使 VDSM
回归能够响应请求的状态，从而解决这个问题。

OVIRT 引入了“通过 SSH 软隔离”的机制。OVIRT 中的隔离包含了“SSH
软隔离”，MANAGER将尝试通过 SSH 重启无响应的主机上
VDSM；如果MANAGER无法通过 SSH 重启
VDSM，隔离的工作将会交由外部的隔离代理来完成（如果已配置好外部的隔离代理）。

SSH
软隔离工作流程大致如下。首先，在主机上隔离相关的参数必须被配置并启用，必须存在一台正常工作的隔离代理主机（同一数据中的另一主机且其状态为
UP）。当MANAGER与主机的连接超时时，将会发生以下情况。第一次网络连接失败的时候，主机的状态将会更改为“connecting”。然后MANAGER将会做如下两件事情中的一件：进行三次尝试询问
VDSM
的状态，或者等待由主机负载决定的一段间隔。计算该间隔时间长度的公式由如下的配置参数值决定：TimeoutToResetVdsInSeconds（默认为
60 秒） + [DelayResetPerVmInSeconds（默认为 0.5
秒）]\*(主机上所运行的虚拟机数) + [DelayResetForSpmInSeconds（默认为 20
秒）]\*1（如果主机作为 SPM 运行）或者 0（主机不为 SPM 的情况）。为了给
VDSM 最多的时间进行响应，MANAGER将选择上面两个选项（三次尝试获取 VDSM
状态或者等待由上面公式决定的时间间隔）中所需时间更长的那个。如果主机在该间隔过去之后仍无响应，将会通过
SSH 在其之上运行 *vdsm restart*。如果 *vdsm restart*
无法成功地使MANAGER和主机间的连接重新建立起来，主机的状态将更改为 *non
responsive*，并且，如果电源管理已经配置，隔离工作将会交给外部的隔离代理来完成。

> **Note**
>
> SSH
> 软隔离能够在未配置电源管理的主机上执行。这和之前章节提到过的“隔离”不同：隔离操作只能在配置了电源管理的主机上执行。
